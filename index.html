<!DOCTYPE html>
<html>
<head>
    <title>4Mi</title>
    <script src="https://apis.google.com/js/api.js"></script>

    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f2f2f2;
            margin: 0;
            padding: 20px;
        }
    
        h1 {
            text-align: center;
            color: #333;
        }
    
        .container {
            max-width: 500px;
            margin: 0 auto;
            background-color: #fff;
            border-radius: 5px;
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
    
        label {
            font-weight: bold;
            display: block;
            margin-bottom: 10px;
        }
    
        textarea {
            width: 95%;
            height: 100px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            resize: vertical;
        }
    
        button {
            background-color: #4CAF50;
            color: #fff;
            border: none;
            padding: 10px 20px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin-top: 10px;
            cursor: pointer;
            border-radius: 4px;
            justify-content: center;
        }
    
        #result {
            display: none;
        }
    
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
    
        table th,
        table td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #ccc;
        }
    
        input {
            width: 100%;
            padding: 10px;
            height: 40px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
    
        form {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            max-width: 500px;
            margin: 20px auto;
        }
    
        form button {
            flex-basis: 100%;
            margin-top: 10px;
        }
    
        table th {
            background-color: #4CAF50;
            color: #fff;
        }
    </style>
</head>
<body>
    <h1>4Mi</h1>
    <div class="container">
        <label for="message">SMS:</label>
        <textarea id="message"></textarea>
        <button onclick="addEntry()">Add</button>
        <div id="result"></div>
    </div>

    <table id="data-table">
        <tr>
            <th>Date</th>
            <th>Bank</th>
            <th>Operation</th>
            <th>Currency</th>
            <th>Value</th>
            <th>File</th>
        </tr>
    </table>
    <script>
        function addEntry() {
            var message = document.getElementById('message').value;

            var bank = message.split(' ')[0] + ' ' + message.split(' ')[1];
            bank = bank.slice(0, -1);
            if (bank.includes('sakartvelos banki')) {
                bank = 'BOG';
            } else if (bank.includes('tbc banki')) {
                bank = 'TBC';
            }

            var operation = '';
            if (message.includes('gasavlis operacia')) {
                operation = 'Expense';
            } else if (message.includes('tanxis charicxva')) {
                operation = 'Income';
            } else {
                operation = 'N/A';
            }

            var currencyPattern = /tanxa: (.+)/;
            var currencyMatches = message.match(currencyPattern);
            var currency = currencyMatches ? currencyMatches[1].substring(0, 3) : 'N/A';
            var value = currencyMatches ? parseFloat(currencyMatches[1].substring(3).replace(/,/g, '')) : 0;

            var filePattern = /angarishidan: (.+)/;
            var fileMatches = message.match(filePattern);
            var file = fileMatches ? 'Yes' : 'No';

            var datePattern = /tarigi: (.+)/;
            var dateMatches = message.match(datePattern);
            var date = dateMatches ? dateMatches[1] : 'N/A';

            var table = document.getElementById('data-table');

            // Create table row with data
            var dataRow = document.createElement('tr');
            var dateCell = document.createElement('td');
            dateCell.textContent = date;
            dataRow.appendChild(dateCell);

            var bankCell = document.createElement('td');
            bankCell.textContent = bank;
            dataRow.appendChild(bankCell);

            var operationCell = document.createElement('td');
            operationCell.textContent = operation;
            dataRow.appendChild(operationCell);

            var currencyCell = document.createElement('td');
            currencyCell.textContent = currency;
            dataRow.appendChild(currencyCell);

            var valueCell = document.createElement('td');
            valueCell.textContent = value.toFixed(2);
            dataRow.appendChild(valueCell);

            var fileCell = document.createElement('td');
            fileCell.textContent = file;
            dataRow.appendChild(fileCell);

            table.appendChild(dataRow);

            var entryData = [date, bank, operation, currency, value.toFixed(2), file];

            document.cookie = "G_ENABLED_IDPS=1; SameSite=None; Secure";

            // Call the function to send data to Google Sheets API
            sendDataToGoogleSheets(entryData);
        }

        function sendDataToGoogleSheets(data) {
    var params = {
        spreadsheetId: 'AKfycbxr2VgE1aBRoBgzdruq0AtulIkYRykacK7ISOMi3rWMl6yCZCED-iCXhAjEjvUkNtMrPw',
        range: 'A1:G100',
        valueInputOption: 'USER_ENTERED',
    };

    var valueRangeBody = {
        values: [data],
    };

    // Retrieve the access token from the current user session or wherever it's stored
    var accessToken = 'https://www.googleapis.com/auth/cloud-platform';

    // Include the access token in the authorization header
    var headers = {
        Authorization: 'Bearer ' + accessToken,
    };

    gapi.client.request({
        path: `https://sheets.googleapis.com/v4/spreadsheets/${params.spreadsheetId}/values/${params.range}:append`,
        method: 'POST',
        headers: headers,
        body: valueRangeBody,
    }).then(function(response) {
        console.log('Data successfully added to Google Sheets:', response);
    }, function(error) {
        console.error('Error adding data to Google Sheets:', error.result.error.message);
    });
}


        function init() {
    gapi.client.init({
        clientId: '978913242858-g57l4fsjle12g11o69laku40i6s7nesh.apps.googleusercontent.com',
        discoveryDocs: ['https://sheets.googleapis.com/$discovery/rest?version=v4'],
        scope: 'https://www.googleapis.com/auth/spreadsheets',
    }).then(function() {
        console.log('Google Sheets API initialized');
    }, function(error) {
        console.error('Error initializing Google Sheets API:', error);
    });
}

        // Load the Google Sheets API client
        gapi.load('client', init);
    </script>
    <script src="https://content-sheets.googleapis.com/static/proxy.html?usegapi=1&jsh=m%3B%2F_%2Fscs%2Fapps-static%2F_%2Fjs%2Fk%3Doz.gapi.en_GB.mbfyzufGv4U.O%2Fam%3DAQ%2Fd%3D1%2Frs%3DAGLTcCPrjA9olXaas0jOK6bo7-AbYUuUcQ%2Fm%3D__features__"></script>
</body>
</html>
